// <auto-generated/>
#nullable enable
using Dapper;
using DbScriptReader;
using System;
using System.Collections.Generic;
using System.Data;
using System.IO;
using System.Threading;
using System.Threading.Tasks;

{{~ if parameters_names == `` ~}}

{{~ return_statement = `return text;` ~}}
{{~ method_call      = method_name + `()` ~}}
{{~ new_parameters   = `object? param = null` ~}}

{{~ else ~}}

{{~ return_statement = `return string.Format(text, ` + parameters_names + `);` ~}}
{{~ method_call      = method_name + `(` + parameters_names + `)` ~}}
{{~ new_parameters   = parameters_syntax + `, object? param = null` ~}}

{{~ end ~}}

{{~ class_header ~}}

// Suppressing default values warning since parameters syntax is copied as is.
#pragma warning disable CS1066
		{{ method_modifiers }} {{ method_return_type }} {{ method_name }}({{ parameters_syntax }})
#pragma warning restore CS1066
		{
			var directory = GetDirectory() ?? AppDomain.CurrentDomain.BaseDirectory;
			var file = Path.Combine(directory, {{ script_path }}); // Attribute argument.
			var text = File.ReadAllText(file);
			{{ return_statement }}
		}

		#region Execute

		{{ new_method_modifiers }} int Execute{{ method_name }}({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.Invoke(this, connection => connection.Execute(sql, param));
		}

		{{ new_method_modifiers }} Task<int> Execute{{ method_name }}Async({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.InvokeAsync(this, connection => connection.ExecuteAsync(sql, param));
		}

		#endregion

		#region Execute Scalar

		{{ new_method_modifiers }} T Execute{{ method_name }}Scalar<T>({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.Invoke(this, connection => connection.ExecuteScalar<T>(sql, param));
		}

		{{ new_method_modifiers }} Task<T> Execute{{ method_name }}ScalarAsync<T>({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.InvokeAsync(this, connection => connection.ExecuteScalarAsync<T>(sql, param));
		}

		#endregion

		#region Execute Reader

		{{ new_method_modifiers }} IDataReader Execute{{ method_name }}Reader({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.Invoke(this, connection => connection.ExecuteReader(sql, param));
		}

		{{ new_method_modifiers }} Task<IDataReader> Execute{{ method_name }}ReaderAsync({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.InvokeAsync(this, connection => connection.ExecuteReaderAsync(sql, param));
		}

		#endregion

		#region Query

		{{ new_method_modifiers }} IEnumerable<T> Query{{ method_name }}<T>({{ new_parameters }}, bool buffered = false)
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.Invoke(this, connection => connection.Query<T>(sql, param, buffered: buffered));
		}

		{{ new_method_modifiers }} Task<IEnumerable<T>> Query{{ method_name }}Async<T>({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.InvokeAsync(this, connection => connection.QueryAsync<T>(sql, param));
		}

		#endregion

		#region Query Multiple

		{{ new_method_modifiers }} SqlMapper.GridReader Query{{ method_name }}Multiple<T>({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.Invoke(this, connection => connection.QueryMultiple(sql, param));
		}

		{{ new_method_modifiers }} Task<SqlMapper.GridReader> Query{{ method_name }}MultipleAsync<T>({{ new_parameters }})
		{
			var sql = {{ method_call }};
			return DbScriptReaderHandler.InvokeAsync(this, connection => connection.QueryMultipleAsync(sql, param));
		}

		#endregion

{{~ class_footer ~}}
